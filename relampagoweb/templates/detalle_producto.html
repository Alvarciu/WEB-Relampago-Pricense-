{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: center; padding-top: 40px;">
  <!-- Contenedor centrado horizontalmente -->
  <div style="display: flex; gap: 40px; max-width: 1200px; width: 100%; padding: 20px;">
    
    <!-- Imagen a la izquierda -->
    <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
      <img src="{{ producto.imagen.url }}" width="100%" style="max-width: 400px; height: auto; border-radius: 8px;">
    </div>

    <!-- Contenido a la derecha centrado en su zona -->
    <div style="
      flex: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    ">
      <h2 style="font-family: monospace">{{ producto.nombre }}</h2>
      <hr style="width: 100%; border: 1px solid #000000; margin: 10px 0;">
      <p>{{ producto.descripcion }}</p>
      <p><strong>{{ producto.precio }} ‚Ç¨</strong></p>

      <form id="form-anadir-carrito" method="post" action="{% url 'a√±adir_al_carrito' producto.id %}" data-tipo="{{ producto.tipo }}" style="width: 100%; max-width: 300px;">
        {% csrf_token %}
        <label>Talla:</label>
        <select name="talla" required>
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
        </select><br><br>

        {% if producto.tipo == 'equipacion' %}
          <label>Nombre dorsal:</label>
          <input type="text" name="nombre_dorsal"><br>
          <label>N√∫mero dorsal:</label>
          <input type="number" name="numero_dorsal"><br>
        {% endif %}

        <button type="submit" style="background-color: #f1c40f; color: black; font-weight: bold; padding: 10px 20px; border: none; border-radius: 5px;">
          A√±adir al carrito
        </button>
        
      </form>
    </div>
  </div>
</div>

<!-- SweetAlert2 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('#form-anadir-carrito');

    if (form) {
      form.addEventListener('submit', function (e) {
        const tipoProducto = form.dataset.tipo;
        const nombre = form.querySelector('input[name="nombre_dorsal"]');
        const numero = form.querySelector('input[name="numero_dorsal"]');

        if (tipoProducto === 'equipacion') {
          const nombreVacio = !nombre || nombre.value.trim() === "";
          const numeroVacio = !numero || numero.value.trim() === "";

          if (nombreVacio || numeroVacio) {
            e.preventDefault();

            Swal.fire({
              title: '‚ö†Ô∏è Camiseta sin personalizar',
              text: 'No has introducido nombre o n√∫mero de dorsal. ¬øQuieres a√±adirla igualmente?',
              icon: 'warning',
              showCancelButton: true,
              confirmButtonText: 'S√≠, a√±adir al carrito',
              cancelButtonText: 'No, volver'
            }).then((result) => {
              if (result.isConfirmed) {
                form.submit();
              }
            });
          }
        }
      });

      // Mostrar mensaje de √©xito si se a√±adi√≥
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("a√±adido") === "ok") {
        Swal.fire({
          title: 'üì¶ Producto a√±adido',
          text: 'El producto se ha a√±adido correctamente al carrito.',
          icon: 'success',
          timer: 1500,
          showConfirmButton: false
        });
      }
    }
  });
</script>
{% endblock %}