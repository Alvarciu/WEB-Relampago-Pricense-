{% extends "base.html" %}

{% block content %}
<h2>{{ producto.nombre }}</h2>
<img src="{{ producto.imagen.url }}" width="300">
<p>{{ producto.descripcion }}</p>
<p><strong>{{ producto.precio }} ‚Ç¨</strong></p>

<form id="form-anadir-carrito" method="post" action="{% url 'a√±adir_al_carrito' producto.id %}" data-tipo="{{ producto.tipo }}">
  {% csrf_token %}
  <label>Talla:</label>
  <select name="talla" required>
    <option value="S">S</option>
    <option value="M">M</option>
    <option value="L">L</option>
    <option value="XL">XL</option>
  </select><br><br>

  {% if producto.tipo == 'equipacion' %}
    <label>Nombre dorsal:</label>
    <input type="text" name="nombre_dorsal"><br>
    <label>N√∫mero dorsal:</label>
    <input type="number" name="numero_dorsal"><br>
  {% endif %}

  <button type="submit">A√±adir al carrito</button>
</form>

<!-- A√±ade esto en tu producto_detail.html -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('#form-anadir-carrito');

    if (form) {
      form.addEventListener('submit', function (e) {
        const tipoProducto = form.dataset.tipo;
        const nombre = form.querySelector('input[name="nombre_dorsal"]');
        const numero = form.querySelector('input[name="numero_dorsal"]');

        if (tipoProducto === 'equipacion') {
          const nombreVacio = !nombre || nombre.value.trim() === "";
          const numeroVacio = !numero || numero.value.trim() === "";

          if (nombreVacio || numeroVacio) {
            e.preventDefault(); // Evita que se env√≠e el form autom√°ticamente

            Swal.fire({
              title: '‚ö†Ô∏è Camiseta sin personalizar',
              text: 'No has introducido nombre o n√∫mero de dorsal. ¬øQuieres a√±adirla igualmente?',
              icon: 'warning',
              showCancelButton: true,
              confirmButtonText: 'S√≠, a√±adir al carrito',
              cancelButtonText: 'No, volver'
            }).then((result) => {
              if (result.isConfirmed) {
                form.submit();
              }
            });
          }
        }
      });

      // Mostrar confirmaci√≥n tras enviar (si no cancelamos antes)
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("a√±adido") === "ok") {
        Swal.fire({
          title: 'üì¶ Producto a√±adido',
          text: 'El producto se ha a√±adido correctamente al carrito.',
          icon: 'success',
          timer: 2000,
          showConfirmButton: false
        });
      }
    }
  });
</script>
{% endblock %}
