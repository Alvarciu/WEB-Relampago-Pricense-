{% extends "base.html" %}
{% block content %}

<h2>Pedidos registrados</h2>

<!-- Mostrar estado actual y botón para abrir/cerrar pedidos -->
<p>
  {% if pedidos_abiertos %}
    ✅ <strong>Pedidos abiertos</strong> |
    🔒 <a href="{% url 'cerrar_pedidos' %}">Cerrar pedidos</a>
  {% else %}
    ❌ <strong>Pedidos cerrados</strong> |
    🔓 <a href="{% url 'abrir_pedidos' %}">Abrir pedidos</a>
  {% endif %}
</p>

<!-- Botón de exportar a Excel -->
<p>
  📦 <a href="{% url 'exportar_pedidos' %}">Exportar pedidos a Excel</a>
</p>

<!-- Tabla de pedidos -->
<table border="1" cellpadding="5" cellspacing="0">
  <thead>
    <tr>
      <th>ID</th>
      <th>Usuario</th>
      <th>Email</th>
      <th>Fecha</th>
      <th>Total</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for pedido in pedidos %}
    <tr>
      <td>{{ pedido.id }}</td>
      <td>{{ pedido.usuario.name }}</td>
      <td>{{ pedido.usuario.email }}</td>
      <td>{{ pedido.fecha|date:"d/m/Y H:i" }}</td>
      <td>{{ pedido.total }} €</td>
      <td>
        🔍 <a href="{% url 'detalle_pedido_admin' pedido.id %}">Ver detalles</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
