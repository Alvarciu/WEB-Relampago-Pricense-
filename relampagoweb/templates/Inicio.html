{% extends "base.html" %}
{% load static %}

{% block extra_head %}
  <!-- Swiper CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  />

  <!-- CSS Historia & Equipo + breakpoint grid -->
  <style>
    /* Historia del club */
    .historia-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    .historia-card h5 {
      font-weight: 600;
      margin-bottom: .75rem;
    }

    /* Jugadores */
    .equipo-card .jugador-img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .equipo-card .card-title,
    .equipo-card .card-text {
      font-weight: bold;
    }

    /* -------------------------------
       POR DEFECTO: grid visible, swiper oculto
       ------------------------------- */
    .carrusel-mobile { display: none; }
    .carrusel-desktop { display: block; }

    /* Desktop/tablet >576px: grid en flex de 3 columnas */
    @media (min-width: 577px) {
      .carrusel-desktop {
        display: flex !important;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 1.5rem;
      }
      /* Dentro del grid, cada card ocupa ~32% */
      .carrusel-desktop > .historia-card,
      .carrusel-desktop > .card.equipo-card {
        flex: 0 0 32%;
      }
    }

    /* Móvil ≤576px: swipers visibles, grid oculto */
    @media (max-width: 576px) {
      .carrusel-mobile { display: block; }
      .carrusel-desktop { display: none; }

      /* Ajustes swiper móvil */
      .swiper-slide { display: flex; justify-content: center; }
      .historia-card,
      .card.equipo-card { width: 95%; max-width: 350px; margin: auto; }
      .swiper-pagination { margin-top: 20px; }
    }
  </style>
{% endblock %}

{% block content %}
  <!-- Hero / Bienvenida -->
  <section class="container py-5 text-center">
    {% if user.is_authenticated %}
      <h2 class="display-4">¡Bienvenido, {{ user.name }}!</h2>
      <p class="lead">Explora nuestra tienda o consulta tus últimos pedidos.</p>
    {% else %}
      <h2 class="display-4">¡Bienvenido a Relámpago Pricense FC!</h2>
      <p class="lead">
        Descubre nuestra equipación oficial –  
        <a href="{% url 'login' %}">Inicia sesión</a> o  
        <a href="{% url 'registro' %}">Regístrate</a> para comprar.
      </p>
    {% endif %}
  </section>

  <!-- Historia del club -->
  <section class="container mb-5">
    <h3 class="titulo-seccion text-center mb-4">Historia del club</h3>

    <!-- Swiper móvil -->
    <div class="swiper historia-swiper carrusel-mobile">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="historia-card">
            <h5>Fundación</h5>
            <p>El Relámpago Pricense FC se fundó en 1965 con la ilusión de crear un proyecto deportivo arraigado en nuestra localidad. Aunque el equipo desapareció durante unos años, ahora hemos vuelto con la máxima ilusión.</p>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="historia-card">
            <h5>Equipo Actualmente</h5>
            <p>Desde la temporada pasada, año donde el equipo volvió a surgir, competimos en la Liga Local Diputación Aficionado de fútbol sala (Grupo Bronce). Esta temporada luchamos por el ansiado ascenso al Grupo Plata.</p>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="historia-card">
            <h5>Actividades Importantes</h5>
            <p>Además de competir, organizamos el Torneo de Fútbol Sala de Priego. Llevamos dos ediciones y este año os esperamos el 8 y 9 de agosto en el IES Diego Jesús Jiménez para la III edición.</p>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
    </div>

    <!-- Grid desktop/tablet -->
    <div class="carrusel-desktop">
      <div class="historia-card">
        <h5>Fundación</h5>
        <p>El Relámpago Pricense FC se fundó en 1965 con la ilusión de crear un proyecto deportivo arraigado en nuestra localidad. Aunque el equipo desapareció durante unos años, ahora hemos vuelto con la máxima ilusión.</p>
      </div>
      <div class="historia-card">
        <h5>Equipo Actualmente</h5>
        <p>Desde la temporada pasada, año donde el equipo volvió a surgir, competimos en la Liga Local Diputación Aficionado de fútbol sala (Grupo Bronce). Esta temporada luchamos por el ansiado ascenso al Grupo Plata.</p>
      </div>
      <div class="historia-card">
        <h5>Actividades Importantes</h5>
        <p>Además de competir, organizamos el Torneo de Fútbol Sala de Priego. Llevamos dos ediciones y este año os esperamos el 8 y 9 de agosto en el IES Diego Jesús Jiménez para la III edición.</p>
      </div>
    </div>
  </section>

  <!-- Nuestro Equipo -->
  <section class="container seccion-equipo py-5">
    <h3 class="titulo-seccion text-center mb-4">Nuestro Equipo</h3>
    <p class="text-center mb-4">Conoce a las leyendas detrás del relámpago.</p>

    <!-- Swiper móvil -->
    <div class="swiper equipo-swiper carrusel-mobile">
      <div class="swiper-wrapper">
        {% for jugador in jugadores %}
          <div class="swiper-slide">
            <div class="card equipo-card h-100 text-center">
              <img src="{{ jugador.foto.url }}" alt="{{ jugador.nombre }}" class="jugador-img">
              <div class="card-body">
                <h5 class="card-title">{{ jugador.nombre }}</h5>
                <p class="card-text">{{ jugador.posicion }}</p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="swiper-pagination"></div>
    </div>

    <!-- Grid desktop/tablet -->
    <div class="carrusel-desktop">
      {% for jugador in jugadores %}
        <div class="card equipo-card h-100 text-center">
          <img src="{{ jugador.foto.url }}" alt="{{ jugador.nombre }}" class="jugador-img">
          <div class="card-body">
            <h5 class="card-title">{{ jugador.nombre }}</h5>
            <p class="card-text">{{ jugador.posicion }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>

  <!-- CTA -->
  <section class="container text-center py-5">
    <a href="{% url 'tienda' %}" class="btn btn-lg btn-outline-primary">
      Ir a la tienda ⚡
    </a>
  </section>
{% endblock %}

{% block extra_js %}
  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    function initSwiper(sel) {
      return new Swiper(sel, {
        slidesPerView: 1.2,
        spaceBetween: 15,
        centeredSlides: true,
        autoHeight: true,
        pagination: {
          el: sel + ' .swiper-pagination',
          clickable: true
        },
        on: {
          init() {
            this.slides.forEach(s => s.classList.remove('is-centered'));
            this.slides[this.activeIndex].classList.add('is-centered');
          },
          slideChange() {
            this.slides.forEach(s => s.classList.remove('is-centered'));
            this.slides[this.activeIndex].classList.add('is-centered');
          }
        }
      });
    }

    let historiaSwiper, equipoSwiper;
    function actualizarSwipers() {
      const móvil = window.innerWidth <= 576;
      if (móvil) {
        if (!historiaSwiper) historiaSwiper = initSwiper('.historia-swiper');
        if (!equipoSwiper)   equipoSwiper   = initSwiper('.equipo-swiper');
      } else {
        historiaSwiper?.destroy(); historiaSwiper = null;
        equipoSwiper?.destroy();   equipoSwiper   = null;
      }
    }

    window.addEventListener('load', actualizarSwipers);
    window.addEventListener('resize', actualizarSwipers);
  </script>
{% endblock %}
